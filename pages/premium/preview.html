<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Preview</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <!-- Header -->
  <header class="bg-green-900 text-white">
    <div class="mx-auto max-w-md px-4 py-4 flex items-center justify-between">
      <h1 class="text-lg font-semibold">Preview Submission</h1>
      <button id="closeBtn" class="rounded-full p-2 hover:bg-white/10" title="Close">✕</button>
    </div>
  </header>

  <!-- Content -->
  <main class="mx-auto max-w-md px-4 py-6 space-y-6">
    <!-- Summary -->
    <section class="bg-white rounded-2xl shadow p-5">
      <h2 class="text-xl font-bold mb-4">Business Info</h2>
      <dl class="space-y-3 text-gray-700">
        <div class="flex justify-between gap-4">
          <dt class="font-medium text-gray-500">Name</dt>
          <dd id="pName" class="text-right max-w-[60%]"></dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="font-medium text-gray-500">Category</dt>
          <dd id="pCategory" class="text-right max-w-[60%]"></dd>
        </div>
        <div>
          <dt class="font-medium text-gray-500">Bio</dt>
          <dd id="pBio" class="mt-1"></dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="font-medium text-gray-500">Focus</dt>
          <dd id="pFocus" class="text-right max-w-[60%]"></dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="font-medium text-gray-500">Capacity (₦)</dt>
          <dd id="pCapacity" class="text-right max-w-[60%]"></dd>
        </div>
        <div class="flex justify-between gap-4">
          <dt class="font-medium text-gray-500">Experience</dt>
          <dd id="pExperience" class="text-right max-w-[60%]"></dd>
        </div>
      </dl>
    </section>

    <!-- Files -->
    <section class="bg-white rounded-2xl shadow p-5 space-y-5">
      <h2 class="text-xl font-bold">Uploaded Files</h2>

      <!-- Photo -->
      <div id="photoBlock" class="hidden">
        <h3 class="font-medium text-gray-700 mb-2">Profile Photo / Logo</h3>
        <img id="photoImg"
             class="w-full max-h-80 object-contain rounded-xl border"
             alt="Uploaded image preview" />
        <p id="photoName" class="text-sm text-gray-500 mt-2"></p>
      </div>

      <!-- ID Doc (PDF or image) -->
      <div id="docBlock" class="hidden">
        <h3 class="font-medium text-gray-700 mb-2">ID Document (Optional)</h3>
        <!-- Shown if PDF -->
        <embed id="docPdf" type="application/pdf"
               class="hidden w-full h-96 rounded-xl border" />
        <!-- Shown if image -->
        <img id="docImg"
             class="hidden w-full max-h-96 object-contain rounded-xl border"
             alt="Uploaded document image preview" />
        <p id="docName" class="text-sm text-gray-500 mt-2"></p>
      </div>
    </section>
  </main>

  <!-- Sticky footer actions -->
  <footer class="sticky bottom-0 bg-white border-t">
    <div class="mx-auto max-w-md px-4 py-4 space-y-3">
      <button id="editBtn"
              class="w-full rounded-full border border-gray-300 bg-gray-100 text-gray-700 py-3 text-base font-medium hover:bg-gray-200">
        Edit
      </button>
      <button id="submitBtn"
              class="w-full rounded-full bg-orange-500 text-white py-3 text-base font-semibold hover:bg-orange-600">
        Submit
      </button>
    </div>
  </footer>

  <script>
    // Read data
    const raw = localStorage.getItem('investorPreviewData');
    let data = {};
    try { data = raw ? JSON.parse(raw) : {}; } catch (e) {}

    // Fill text
    const set = (id, text) => { const el = document.getElementById(id); if (el) el.textContent = text || '—'; };
    set('pName', data.name);
    set('pCategory', data.category);
    set('pBio', data.bio);
    set('pFocus', data.focus);
    set('pCapacity', data.capacity);
    set('pExperience', data.experience);

    // Photo
    if (data.photoURL) {
      const img = document.getElementById('photoImg');
      img.src = data.photoURL;
      document.getElementById('photoName').textContent = data.photoName || '';
      document.getElementById('photoBlock').classList.remove('hidden');
    }

    // ID doc: PDF or image
    if (data.idDocURL) {
      const isPdf = (data.idDocType || '').includes('pdf') || (data.idDocName || '').toLowerCase().endsWith('.pdf');
      const pdf = document.getElementById('docPdf');
      const img = document.getElementById('docImg');
      if (isPdf) {
        pdf.src = data.idDocURL;
        pdf.classList.remove('hidden');
      } else {
        img.src = data.idDocURL;
        img.classList.remove('hidden');
      }
      document.getElementById('docName').textContent = data.idDocName || '';
      document.getElementById('docBlock').classList.remove('hidden');
    }

    // Buttons
    document.getElementById('closeBtn').onclick = () => window.close();
    document.getElementById('editBtn').onclick = () => window.close();
    document.getElementById('submitBtn').onclick = () => {
      if (window.opener && !window.opener.closed) {
        window.opener.postMessage('SUBMIT_INVESTOR_FORM', '*');
      }
      window.close();
    };

    // Clean up the stored data when leaving the preview
    window.addEventListener('unload', () => {
      localStorage.removeItem('investorPreviewData');
    });
  </script>
</body>
</html>
